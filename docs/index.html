<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InventoryOS | Enterprise Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .tab-active { border-bottom: 3px solid #6366f1; color: #6366f1; font-weight: 800; }
        .glass-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); }
        .status-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

    <header class="glass-header border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 text-white p-2 rounded-xl shadow-lg">
                    <i class="fas fa-warehouse text-lg"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black tracking-tight uppercase">Inventory<span class="text-indigo-600">OS</span></h1>
                    <p class="text-[10px] font-bold text-slate-400 flex items-center gap-1">
                        <span class="h-2 w-2 bg-emerald-500 rounded-full status-pulse"></span> SYSTEM CONNECTED
                    </p>
                </div>
            </div>
            <div id="sync-timer" class="text-xs font-mono text-slate-400 italic">Last Sync: Just now</div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8">
        
        <div class="flex gap-8 border-b border-slate-200 mb-8">
            <button onclick="switchTab('inventory')" id="tab-inventory" class="pb-3 text-sm font-bold uppercase tracking-wider tab-active transition-all">Live Inventory</button>
            <button onclick="switchTab('orders')" id="tab-orders" class="pb-3 text-sm font-bold uppercase tracking-wider text-slate-400 hover:text-indigo-500 transition-all">Order Center</button>
            <button onclick="switchTab('stakeholders')" id="tab-stakeholders" class="pb-3 text-sm font-bold uppercase tracking-wider text-slate-400 hover:text-indigo-500 transition-all">Supply Chain</button>
        </div>

        <div id="section-inventory" class="animate-fade-in">
            <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 text-[10px] uppercase font-black tracking-widest text-slate-400 border-b">
                        <tr>
                            <th class="px-6 py-4">SKU/ID</th>
                            <th class="px-6 py-4">Product Name</th>
                            <th class="px-6 py-4">Unit Price</th>
                            <th class="px-6 py-4">Stock Level</th>
                            <th class="px-6 py-4">Risk Level</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryBody" class="divide-y divide-slate-100">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="section-orders" class="hidden grid grid-cols-12 gap-8">
            <div class="col-span-12 lg:col-span-4 space-y-6">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <h3 class="text-xs font-black uppercase text-slate-400 mb-5 tracking-widest">Execute New Order</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Customer</label>
                            <select id="orderCustomer" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500"></select>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Product SKU</label>
                            <select id="orderProduct" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500"></select>
                        </div>
                        <div>
                            <label class="text-[10px] font-bold text-slate-500 uppercase ml-1">Quantity</label>
                            <input type="number" id="orderQty" placeholder="0" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <button onclick="placeOrder()" class="w-full bg-indigo-600 text-white font-black py-4 rounded-xl shadow-lg hover:bg-indigo-700 transition-all flex items-center justify-center gap-2">
                            PLACE ORDER <i class="fas fa-check-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-span-12 lg:col-span-8 bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="px-6 py-4 border-b border-slate-100"><h3 class="text-sm font-bold text-slate-800">Recent Transactions</h3></div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400">
                            <tr>
                                <th class="px-6 py-4">Order ID</th>
                                <th class="px-6 py-4">Product</th>
                                <th class="px-6 py-4">Qty</th>
                                <th class="px-6 py-4">Status</th>
                            </tr>
                        </thead>
                        <tbody id="ordersBody" class="text-sm divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="section-stakeholders" class="hidden grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6">
                <h3 class="text-xs font-black uppercase text-indigo-500 mb-4 tracking-widest">Global Suppliers</h3>
                <div id="suppliersList" class="space-y-3"></div>
            </div>
            <div class="bg-white rounded-3xl shadow-sm border border-slate-200 p-6">
                <h3 class="text-xs font-black uppercase text-emerald-500 mb-4 tracking-widest">Active Customers</h3>
                <div id="customersList" class="space-y-3"></div>
            </div>
        </div>

    </main>

    <script>
        // Authentication Configuration
        const AUTH = 'Basic ' + btoa('admin:password123'); // Matches your Spring Security config

        function switchTab(tab) {
            ['inventory', 'orders', 'stakeholders'].forEach(t => {
                document.getElementById(`section-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('text-slate-400');
            });
            document.getElementById(`section-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            refreshData();
        }

        async function refreshData() {
            try {
                const endpoints = ['products', 'orders', 'customers', 'suppliers'];
                const [prods, orders, custs, supps] = await Promise.all(
                    endpoints.map(ep => fetch(`/api/${ep}`, { headers: { 'Authorization': AUTH } }).then(r => r.json()))
                );

                renderInventory(prods);
                renderOrders(orders);
                renderStakeholders(custs, supps);
                updateDropdowns(prods, custs);

                document.getElementById('sync-timer').innerText = "Last Sync: " + new Date().toLocaleTimeString();
            } catch (err) {
                console.warn("Backend not detected. Use local Docker instance for full functionality.");
            }
        }

        function renderInventory(prods) {
            document.getElementById('inventoryBody').innerHTML = prods.map(p => `
                <tr class="text-sm font-medium hover:bg-slate-50 transition-colors">
                    <td class="px-6 py-4 font-mono text-xs font-bold text-slate-400">#${p.id}</td>
                    <td class="px-6 py-4 text-slate-800 font-bold">${p.name}</td>
                    <td class="px-6 py-4 text-indigo-600 font-black">$${p.price.toFixed(2)}</td>
                    <td class="px-6 py-4 font-mono">${p.stockQuantity}</td>
                    <td class="px-6 py-4">
                        <span class="${p.stockQuantity < 15 ? 'bg-rose-50 text-rose-600' : 'bg-emerald-50 text-emerald-600'} px-3 py-1 rounded-full text-[10px] font-black uppercase">
                            ${p.stockQuantity < 15 ? 'CRITICAL' : 'STABLE'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        function renderOrders(orders) {
            document.getElementById('ordersBody').innerHTML = orders.map(o => `
                <tr>
                    <td class="px-6 py-4 font-mono font-bold text-slate-300">TRX-${o.id}</td>
                    <td class="px-6 py-4 font-bold text-slate-700">${o.product?.name || 'Item Out of Stock'}</td>
                    <td class="px-6 py-4 font-black text-indigo-600">${o.quantity}</td>
                    <td class="px-6 py-4 uppercase text-[10px] font-black text-slate-400">${o.status}</td>
                </tr>
            `).join('');
        }

        function renderStakeholders(custs, supps) {
            document.getElementById('suppliersList').innerHTML = supps.map(s => `
                <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl border border-slate-100">
                    <span class="text-sm font-bold text-slate-700">${s.supplier_name}</span>
                    <span class="text-[10px] font-mono text-slate-400">${s.contact_email}</span>
                </div>
            `).join('');

            document.getElementById('customersList').innerHTML = custs.map(c => `
                <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl border border-slate-100">
                    <span class="text-sm font-bold text-slate-700">${c.first_name} ${c.last_name}</span>
                    <span class="text-[10px] font-mono text-slate-400 italic">ID: #${c.id}</span>
                </div>
            `).join('');
        }

        function updateDropdowns(prods, custs) {
            document.getElementById('orderCustomer').innerHTML = custs.map(c => `<option value="${c.id}">${c.first_name} ${c.last_name}</option>`).join('');
            document.getElementById('orderProduct').innerHTML = prods.map(p => `<option value="${p.id}">${p.name} ($${p.price})</option>`).join('');
        }

        async function placeOrder() {
            const data = {
                customer: { id: parseInt(document.getElementById('orderCustomer').value) },
                product: { id: parseInt(document.getElementById('orderProduct').value) },
                quantity: parseInt(document.getElementById('orderQty').value)
            };

            const res = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': AUTH },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert("SUCCESS: Order Processed & Stock Updated!");
                refreshData();
            } else {
                alert("ERROR: Transaction declined (Check stock levels).");
            }
        }

        // Auto-refresh every 10 seconds to keep data "Reactive"
        window.onload = refreshData;
        setInterval(refreshData, 10000);
    </script>
</body>
</html>
