<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InventoryOS | Full-Stack Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .tab-active { border-bottom: 3px solid #6366f1; color: #6366f1; font-weight: 800; }
        .glass-nav { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <header class="glass-nav border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 text-white p-2 rounded-xl shadow-lg shadow-indigo-100">
                    <i class="fas fa-microchip"></i>
                </div>
                <h1 class="text-xl font-black tracking-tight uppercase">Warehouse<span class="text-indigo-600">Pro</span></h1>
            </div>
            <div class="flex items-center gap-4 text-xs font-bold text-slate-400">
                <span id="conn-status" class="flex items-center gap-2">
                    <span class="h-2 w-2 bg-emerald-500 rounded-full animate-pulse"></span> Docker-DB Linked
                </span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8">
        
        <div class="flex gap-8 border-b border-slate-200 mb-8">
            <button onclick="switchTab('inventory')" id="tab-inventory" class="pb-3 text-sm font-bold uppercase tracking-wider tab-active transition-all">Inventory</button>
            <button onclick="switchTab('orders')" id="tab-orders" class="pb-3 text-sm font-bold uppercase tracking-wider text-slate-400 hover:text-indigo-500 transition-all">Orders</button>
            <button onclick="switchTab('stakeholders')" id="tab-stakeholders" class="pb-3 text-sm font-bold uppercase tracking-wider text-slate-400 hover:text-indigo-500 transition-all">Suppliers & Customers</button>
        </div>

        <div id="section-inventory" class="space-y-6">
            <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 text-[10px] uppercase font-black tracking-widest text-slate-400 border-b">
                        <tr>
                            <th class="px-6 py-4">ID</th>
                            <th class="px-6 py-4">Product Name</th>
                            <th class="px-6 py-4">Price</th>
                            <th class="px-6 py-4">Stock</th>
                            <th class="px-6 py-4">Status</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryBody" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>
        </div>

        <div id="section-orders" class="hidden space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200 h-fit">
                    <h3 class="text-xs font-black uppercase text-slate-400 mb-4 tracking-widest">Execute Order</h3>
                    <div class="space-y-4">
                        <select id="orderCustomer" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500"></select>
                        <select id="orderProduct" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500"></select>
                        <input type="number" id="orderQty" placeholder="Quantity" class="w-full bg-slate-50 p-3 rounded-xl border border-slate-200 text-sm font-bold outline-none focus:ring-2 focus:ring-indigo-500">
                        <button onclick="placeOrder()" class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-indigo-700 transition-all">Submit Transaction</button>
                    </div>
                </div>
                <div class="md:col-span-2 bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400 border-b">
                            <tr>
                                <th class="px-6 py-4">Order ID</th>
                                <th class="px-6 py-4">Item</th>
                                <th class="px-6 py-4">Qty</th>
                                <th class="px-6 py-4">Status</th>
                            </tr>
                        </thead>
                        <tbody id="ordersBody" class="text-sm divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="section-stakeholders" class="hidden grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden p-6">
                <h3 class="text-xs font-black uppercase text-slate-400 mb-4">Active Suppliers</h3>
                <div id="suppliersList" class="space-y-3"></div>
            </div>
            <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden p-6">
                <h3 class="text-xs font-black uppercase text-slate-400 mb-4">Registered Customers</h3>
                <div id="customersList" class="space-y-3"></div>
            </div>
        </div>

    </main>

    <script>
        const AUTH = 'Basic ' + btoa('admin:password123');

        function switchTab(tab) {
            ['inventory', 'orders', 'stakeholders'].forEach(t => {
                document.getElementById(`section-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('text-slate-400');
            });
            document.getElementById(`section-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
            refreshAll();
        }

        async function apiFetch(endpoint) {
            const res = await fetch(`/api/${endpoint}`, { headers: { 'Authorization': AUTH } });
            return res.json();
        }

        async function refreshAll() {
            const [prods, orders, custs, supps] = await Promise.all([
                apiFetch('products'), apiFetch('orders'), apiFetch('customers'), apiFetch('suppliers')
            ]);

            // Render Inventory
            document.getElementById('inventoryBody').innerHTML = prods.map(p => `
                <tr class="text-sm font-medium">
                    <td class="px-6 py-4 font-mono text-xs font-bold text-slate-300">#${p.id}</td>
                    <td class="px-6 py-4 text-slate-700">${p.name}</td>
                    <td class="px-6 py-4 text-indigo-600 font-bold">$${p.price.toFixed(2)}</td>
                    <td class="px-6 py-4">${p.stockQuantity}</td>
                    <td class="px-6 py-4">
                        <span class="${p.stockQuantity < 10 ? 'bg-rose-50 text-rose-600' : 'bg-emerald-50 text-emerald-600'} px-2 py-1 rounded text-[10px] font-black uppercase">
                            ${p.stockQuantity < 10 ? 'Low' : 'OK'}
                        </span>
                    </td>
                </tr>
            `).join('');

            // Render Orders
            document.getElementById('ordersBody').innerHTML = orders.map(o => `
                <tr class="border-b border-slate-50">
                    <td class="px-6 py-4 font-mono font-bold text-slate-400">TRX-${o.id}</td>
                    <td class="px-6 py-4 font-bold text-slate-800">${o.product?.name || 'N/A'}</td>
                    <td class="px-6 py-4 text-indigo-600 font-black">${o.quantity}</td>
                    <td class="px-6 py-4 uppercase text-[10px] font-black">${o.status}</td>
                </tr>
            `).join('');

            // Dropdowns for Order Form
            document.getElementById('orderCustomer').innerHTML = custs.map(c => `<option value="${c.id}">${c.first_name} ${c.last_name}</option>`).join('');
            document.getElementById('orderProduct').innerHTML = prods.map(p => `<option value="${p.id}">${p.name}</option>`).join('');

            // Stakeholders
            document.getElementById('suppliersList').innerHTML = supps.map(s => `
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <span class="text-sm font-bold text-slate-700">${s.supplier_name}</span>
                    <span class="text-[10px] font-mono text-slate-400">${s.contact_email}</span>
                </div>
            `).join('');

            document.getElementById('customersList').innerHTML = custs.map(c => `
                <div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <span class="text-sm font-bold text-slate-700">${c.first_name} ${c.last_name}</span>
                    <span class="text-[10px] font-mono text-slate-400">${c.email}</span>
                </div>
            `).join('');
        }

        async function placeOrder() {
            const data = {
                customer: { id: parseInt(document.getElementById('orderCustomer').value) },
                product: { id: parseInt(document.getElementById('orderProduct').value) },
                quantity: parseInt(document.getElementById('orderQty').value)
            };

            const res = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': AUTH },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                alert("Order Successful!");
                refreshAll();
            } else {
                alert("Order Failed: Insufficient Stock");
            }
        }

        // Initial Load
        window.onload = refreshAll;
    </script>
</body>
</html>
